
		mnews 郵便(youbin)対応について

1. 概要

mnews の新着メールのチェックに郵便(youbin)プロトコルを使うようにします。

2. youbin とは

youbin は、ネットワーク対応の biff サービスで、メールサーバの負荷が
少ない、新着メールが即時に知ることができる、などの特徴があります。
名古屋大学工学部情報工学科 阿草研究室により開発されました。
youbin を使うには、メールサーバで youbind を動かす必要があります。
また、MH などに対するパッチが作成されています。詳しくは youbin の
パッケージを参照してください。youbin は X11R6 の contrib にも含ま
れています。

3. mnews の youbin 対応化

このパッケージは、mnews の新着メールチェックに、youbin プロトコルを
用いるようにするものです。これにより、mnews の次の機能に youbin
プロトコルを使うようになります。

	(1) メールの着信でベルを鳴らす。
	(2) メールが来ているときに、ステータス行(?)に NEW MAIL の
	    表示をする。
	(3) メールモードに入ったときに、来ているメールを自動的に
	    取り込む。
	    (ただし、 .mnews_setup  に auto_inc_mode: on の指定が
	    必要。)

この機能は、BSD 系のネットワーク機能を持つ OS 上で動作するように
作成しました。また、 select() システムコールが必要です。
移植性には気をつけたつもりですので、他の youbin クライアントが
動作するなら大丈夫でしょう。動作確認は、SunOS 4.1.3_U1, OSF/1 2.0,
Ultrix 4.3 で行いました。

4. インストール

(1) readme.doc に従って config と make をします。
    そのとき、./config.sh あるいは ./config.jsh の実行中に、

     Use 'Youbin' protocol instead of spool for checking mail(YOUBIN)? (y/[n]):

    あるいは、

     新着メールのチェックに郵便(YOUBIN)を使用しますか? (y/[n]):

    と聞いてきますので、y と答えてください。

(2) インストールします。make install などでインストールし、さらに
    default-domain などの設定ファイルと同じディレクトリに
    default-mailsv というファイルを作成し、メールサーバ名を書きます。
	例:
	# cd /usr/local/lib
	# echo mailserver.of.my.domain > default-mailsv
	# chmod 644 default-mailsv
	# ls -lg default-mailsv
	-rw-r--r--   1 root     wheel         24 Jun 28 01:57 default-mailsv

    ただし、環境変数 MAILSERVER が設定ファイルに優先します。

5. 注意点/制限事項

(1) YOUBIN オプションをつけると、スプールなどは全く参照しません。
    youbin サービスが死んでいると、pop などでメールが読めるときでも
    新着メールがないことになってしまいます。

(2) youbin のチェックはキー入力時に行われます。
    そのため、新着メールが来ると、キー入力待ちをしているときなら
    いつでもベルが鳴ります。しかし [NEW MAIL] の表示は mnews に
    まかせているので、次に表示が行われたときになります。

(3) 長時間メールやニュースを書いていても、mnews に復帰すれば
    youbin サービスが継続して受けられるように工夫してはいますが、
    ある条件の下において、youbin サービスが切れてしまうことが
    あり得ます。その場合、再接続には最大20分ほどかかります。
    また、メールサーバの都合でサービスが終了した場合は、再接続を
    行いませんので、mnews を再起動してください。

(4) キー入力、パケットの到着、タイムアウトを select(2) で見ているので、
    select() システムコールのない OS では利用できません。
    また UDP ソケットの実装されていない OS でも利用できません(当然か…)。

(5) youbin サービスを受けているのかどうか、画面を見ただけでは
    全然分かりません。どこに表示していいのかわからないので…。

(6) youbin パッケージに入っている youbin クライアントは、サーバが長時間
    応答しないときにはあきらめるようになっていますが、この youbin.c は
    何回でもリトライし続けます(プロトコル仕様書に書いてないし… :-)。

著作権、その他

youbin.c は、プロトコル仕様書を見ながら書いたオリジナルのコードです。
youbin.c の著作権および著作者人格権は放棄します。もし放棄できない
ものであったとしても、権利を行使しないものとします。ほかのプログラム
を youbin 対応にするなどの場合に自由に使ってください。

謝辞

youbin の開発元である、名古屋大学情報工学科 阿草研究室のみなさんに
感謝します。youbin のおかげで、1000 ものアカウントが一台のメール
サーバを共有しているような環境でも、新着メールチェックがなんとか
できるようになっています。
(それでも失敗することが…サーバが重いんだろうな。)

伊藤 剛氏(奈良先端大 バイオサイエンス研究科)に感謝します。
彼の一言がなければ、mnews の youbin 対応が行われることは
なかったでしょう。(auto_inc_mode なんか知らんかった…。)

三浦正一氏(日本科学技術研修所技術システム本部)に感謝します。
このパッケージの改良につながる示唆をしていだたきました。

参考文献

阿草 清滋、山本 晋一郎 「youbin プロトコル仕様」

変更履歴 (youbin.c)

1996年 10月23日	Revision: 1.3
	マイナーチェンジしました。

1995年  9月 7日	Revision: 1.2
	明らかにプロトコルがタイムアウトしているだけの
	時間が経過していれば、既に到着しているパケット
	を捨て、登録フェーズに入るようにした。
	この変更により、youbin が切れてしまうことが
	なくなった (たぶん…)。

1995年  7月30日	Revision: 1.1(ということにしておいて下さい :-)
	初期バージョン。
--
mnews 1.19 対応 by 伊藤 康史(いとう やすふみ)・奈良県生駒市在住
mnews 1.20 対応 by 伊藤 康史 & 宅間 顯(たくま あきら)
